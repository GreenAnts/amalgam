<!DOCTYPE html>
<html>
<head>
    <title>Ability Animation Tests</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        
        .nav-header {
            background: #333;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .nav-btn {
            display: inline-block;
            padding: 8px 16px;
            margin-right: 10px;
            background: #555;
            color: white;
            text-decoration: none;
            border-radius: 3px;
            transition: background 0.3s;
        }
        
        .nav-btn:hover {
            background: #777;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-header h1 {
            color: #ff6b6b;
            margin: 0;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            min-width: 200px;
        }
        
        .control-group h3 {
            margin: 0 0 10px 0;
            color: #ff6b6b;
        }
        
        .control-group button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.3s;
        }
        
        .control-group button:hover {
            background: #ff5252;
        }
        
        .control-group button.fireball { background: #ff4400; }
        .control-group button.tidalWave { background: #0088ff; }
        .control-group button.sap { background: #88ff00; }
        .control-group button.launch { background: #ffff00; color: #333; }
        
        .canvas-container {
            text-align: center;
            margin-top: 20px;
            position: relative;
        }
        
        #gameCanvas {
            border: 2px solid #555;
            border-radius: 5px;
            background: #000;
            cursor: crosshair;
        }
        
        .info-panel {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .info-panel h3 {
            margin: 0 0 10px 0;
            color: #ff6b6b;
        }
        
        .info-panel p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        .status-panel {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .status-panel h3 {
            margin: 0 0 10px 0;
            color: #ff6b6b;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #555;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Header -->
        <div class="nav-header">
            <a href="../../../tests.html" class="nav-btn">Testing Hub</a>
            <a href="../../comprehensive-game-mechanics-test.html" class="nav-btn">Full Suite</a>
        </div>
        
        <div class="test-header">
            <h1>Ability Animation Tests</h1>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <h3>Fireball Ability</h3>
                <p>Ruby formation line attack</p>
                <button class="fireball" onclick="triggerAbility('fireball')">Cast Fireball</button>
                <button onclick="triggerTargetedAbility('fireball')">Target Fireball</button>
            </div>
            
            <div class="control-group">
                <h3>Tidal Wave Ability</h3>
                <p>Pearl formation area attack</p>
                <button class="tidalWave" onclick="triggerAbility('tidalWave')">Cast Tidal Wave</button>
                <button onclick="triggerTargetedAbility('tidalWave')">Target Tidal Wave</button>
            </div>
            
            <div class="control-group">
                <h3>Sap Ability</h3>
                <p>Amber formation debuff</p>
                <button class="sap" onclick="triggerAbility('sap')">Cast Sap</button>
                <button onclick="triggerTargetedAbility('sap')">Target Sap</button>
            </div>
            
            <div class="control-group">
                <h3>Launch Ability</h3>
                <p>Jade formation movement boost</p>
                <button class="launch" onclick="triggerAbility('launch')">Cast Launch</button>
                <button onclick="triggerTargetedAbility('launch')">Target Launch</button>
            </div>
            
            <div class="control-group">
                <h3>Animation Controls</h3>
                <button onclick="stopAllAnimations()">Stop All</button>
                <button onclick="clearCanvas()">Clear Canvas</button>
                <button onclick="toggleAutoMode()">Toggle Auto Mode</button>
            </div>
        </div>
        
        <!-- Canvas -->
        <div class="canvas-container">
            <canvas id="gameCanvas" width="800" height="600"></canvas>
        </div>
        
        <!-- Status Panel -->
        <div class="status-panel">
            <h3>Animation Status</h3>
            <div class="status-item">
                <span>Active Animations:</span>
                <span id="activeCount">0</span>
            </div>
            <div class="status-item">
                <span>Auto Mode:</span>
                <span id="autoModeStatus">Off</span>
            </div>
            <div class="status-item">
                <span>Last Ability:</span>
                <span id="lastAbility">None</span>
            </div>
        </div>
        
        <!-- Info Panel -->
        <div class="info-panel">
            <h3>Instructions</h3>
            <p><strong>Click on the canvas</strong> to cast abilities at that position</p>
            <p><strong>Use the buttons</strong> to trigger abilities at random positions</p>
            <p><strong>Auto Mode</strong> will continuously cast random abilities</p>
            <p><strong>Each ability</strong> has different particle effects and durations</p>
        </div>
    </div>
    
    <script type="module">
        import { AbilityAnimationManager, createTargetedAbilityAnimation } from './ability-animations.js';
        
        class AbilityAnimationTest {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.animationManager = new AbilityAnimationManager(this.canvas);
                this.lastTime = 0;
                this.autoMode = false;
                this.autoModeInterval = null;
                
                this.initializeEventListeners();
                this.startAnimation();
            }
            
            initializeEventListeners() {
                // Canvas click events
                this.canvas.addEventListener('click', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Cast a random ability at click position
                    const abilities = ['fireball', 'tidalWave', 'sap', 'launch'];
                    const randomAbility = abilities[Math.floor(Math.random() * abilities.length)];
                    
                    this.castAbilityAt(randomAbility, x, y);
                });
                
                // Right click to clear
                this.canvas.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.clearCanvas();
                });
            }
            
            castAbilityAt(abilityType, x, y) {
                const abilityId = createTargetedAbilityAnimation(
                    this.animationManager,
                    abilityType,
                    x,
                    y,
                    150
                );
                
                this.updateStatus();
                console.log(`Casted ${abilityType} at (${x}, ${y})`);
            }
            
            triggerRandomAbility() {
                const abilities = ['fireball', 'tidalWave', 'sap', 'launch'];
                const randomAbility = abilities[Math.floor(Math.random() * abilities.length)];
                const x = Math.random() * this.canvas.width;
                const y = Math.random() * this.canvas.height;
                
                this.castAbilityAt(randomAbility, x, y);
            }
            
            stopAllAnimations() {
                this.animationManager.stopAllAnimations();
                this.updateStatus();
            }
            
            clearCanvas() {
                this.ctx.fillStyle = '#000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            }
            
            toggleAutoMode() {
                this.autoMode = !this.autoMode;
                
                if (this.autoMode) {
                    this.autoModeInterval = setInterval(() => {
                        this.triggerRandomAbility();
                    }, 2000);
                    document.getElementById('autoModeStatus').textContent = 'On';
                } else {
                    if (this.autoModeInterval) {
                        clearInterval(this.autoModeInterval);
                        this.autoModeInterval = null;
                    }
                    document.getElementById('autoModeStatus').textContent = 'Off';
                }
            }
            
            updateStatus() {
                document.getElementById('activeCount').textContent = 
                    this.animationManager.getActiveAnimationCount();
            }
            
            startAnimation() {
                const animate = (currentTime) => {
                    const deltaTime = currentTime - this.lastTime;
                    this.lastTime = currentTime;
                    
                    // Update animations
                    this.animationManager.update(deltaTime);
                    
                    // Render animations
                    this.animationManager.render();
                    
                    // Update status
                    this.updateStatus();
                    
                    requestAnimationFrame(animate);
                };
                
                requestAnimationFrame(animate);
            }
        }
        
        // Global functions for button interactions
        window.triggerAbility = function(abilityType) {
            const x = Math.random() * 800;
            const y = Math.random() * 600;
            testInstance.castAbilityAt(abilityType, x, y);
            document.getElementById('lastAbility').textContent = abilityType;
        };
        
        window.triggerTargetedAbility = function(abilityType) {
            const x = 400 + (Math.random() - 0.5) * 200;
            const y = 300 + (Math.random() - 0.5) * 200;
            testInstance.castAbilityAt(abilityType, x, y);
            document.getElementById('lastAbility').textContent = abilityType;
        };
        
        window.stopAllAnimations = function() {
            testInstance.stopAllAnimations();
        };
        
        window.clearCanvas = function() {
            testInstance.clearCanvas();
        };
        
        window.toggleAutoMode = function() {
            testInstance.toggleAutoMode();
        };
        
        // Initialize the test when the page loads
        let testInstance;
        window.addEventListener('load', () => {
            testInstance = new AbilityAnimationTest();
        });
    </script>
</body>
</html>
