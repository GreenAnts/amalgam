<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Board with Fixed Rotation</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the canvas to ensure it is centered and has a border */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #gameCanvas {
            background-color: #4a5568;
            border: 4px solid #a0aec0;
            border-radius: 1rem;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col items-center justify-center p-4">
    <div class="container mx-auto p-4 md:p-8 bg-gray-800 rounded-2xl shadow-2xl flex flex-col items-center">
        <h1 class="text-4xl font-bold mb-4 text-center">Game Board with Movable Pieces</h1>
        <p class="text-lg text-center mb-6 text-gray-400">
            Click on a piece to select it, then click on an empty intersection to move it. Portal pieces can also move along the golden lines.
        </p>

        <!-- The canvas element for drawing the board -->
        <canvas id="gameCanvas" width="800" height="800" class="w-full max-w-2xl aspect-square"></canvas>

        <!-- Display area for coordinates and game messages -->
        <div class="mt-6 p-4 bg-gray-700 rounded-xl w-full max-w-2xl shadow-inner">
            <h2 class="text-2xl font-semibold mb-2">Selected Coordinates:</h2>
            <p id="selectedCoords" class="font-mono text-xl text-green-300">None</p>
            <p id="gameMessage" class="mt-2 text-yellow-300"></p>
        </div>
    </div>

    <script>
        // Use a function to ensure code runs after the DOM is ready
        window.onload = function() {
            // Get the canvas and context
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const coordsDisplay = document.getElementById('selectedCoords');
            const gameMessageDisplay = document.getElementById('gameMessage');

            // Define the size of the board and grid spacing
            const gridSize = 25; // Spacing between intersections
            let boardSize = Math.min(canvas.width, canvas.height);
            let originX = boardSize / 2;
            let originY = boardSize / 2;
            
            // State for piece movement
            let selectedPieceCoord = null;

            // Define uniform piece sizes based on the new visual style
            const normalPieceSize = gridSize * 0.45;
            const portalPieceSize = gridSize * 0.25;

            // Colors for the amalgam pieces, based on the user's images
            const amalgamColors = ['#E63960', '#A9E886', '#F8F6DA', '#F6C13F'];
            // Colors for the void pieces
            const voidOuterColor = '#5B4E7A';
            const voidInnerColor = '#8D7EA9';
            // Colors for the portal pieces
            const portalOuterColor = '#87CEEB';
            const portalInnerColor = '#ADD8E6';

            /**
             * The pieces object stores all the game pieces. The key is the coordinate string "x,y"
             * and the value is an object describing the piece's properties (name, type, color, size, etc.).
             */
            const pieces = {
                // Amalgam pieces
                '0,6': { name: 'Amalgam-Circle', type: 'amalgamCircle', colors: amalgamColors, size: normalPieceSize, rotation: Math.PI },
                '0,-6': { name: 'Amalgam-Square', type: 'amalgamSquare', colors: amalgamColors, size: normalPieceSize, rotation: -Math.PI / 2 },
                // Void pieces
                '0,12': { name: 'Void-Circle', type: 'voidCircle', outerColor: voidOuterColor, innerColor: voidInnerColor, size: normalPieceSize },
                '0,-12': { name: 'Void-Square', type: 'voidSquare', outerColor: voidOuterColor, innerColor: voidInnerColor, size: normalPieceSize },
                // Portal pieces (slightly smaller)
                '6,6': { name: 'Portal-C1', type: 'portalCircle', outerColor: portalOuterColor, innerColor: portalInnerColor, size: portalPieceSize },
                '6,-6': { name: 'Portal-S1', type: 'portalSquare', outerColor: portalOuterColor, innerColor: portalInnerColor, size: portalPieceSize },
                '-6,6': { name: 'Portal-C2', type: 'portalCircle', outerColor: portalOuterColor, innerColor: portalInnerColor, size: portalPieceSize },
                '-6,-6': { name: 'Portal-S2', type: 'portalSquare', outerColor: portalOuterColor, innerColor: portalInnerColor, size: portalPieceSize },
            };

            /**
             * The boardDict object holds all valid intersection coordinates as keys.
             * This allows for quick lookup to see if a clicked point is a valid spot on the board.
             */
            const boardDict = {
                // Centers
                '0,0': true, '0,1': true, '0,-1': true, '1,0': true, '-1,0': true,
                '0,2': true, '0,-2': true, '2,0': true, '-2,0': true,
                '0,3': true, '0,-3': true, '3,0': true, '-3,0': true,
                '0,4': true, '0,-4': true, '4,0': true, '-4,0': true,
                '0,5': true, '0,-5': true, '5,0': true, '-5,0': true,
                '0,6': true, '0,-6': true, '6,0': true, '-6,0': true,
                '0,7': true, '0,-7': true, '7,0': true, '-7,0': true,
                '0,8': true, '0,-8': true, '8,0': true, '-8,0': true,
                '0,9': true, '0,-9': true, '9,0': true, '-9,0': true,
                '0,10': true, '0,-10': true, '10,0': true, '-10,0': true,
                '0,11': true, '0,-11': true, '11,0': true, '-11,0': true,
                '0,12': true, '0,-12': true, '12,0': true, '-12,0': true,
                // Cross connections
                '1,1': true, '-1,1': true, '-1,-1': true, '1,-1': true,
                '2,2': true, '-2,2': true, '-2,-2': true, '2,-2': true,
                '3,3': true, '-3,3': true, '-3,-3': true, '3,-3': true,
                '4,4': true, '-4,4': true, '-4,-4': true, '4,-4': true,
                '5,5': true, '-5,5': true, '-5,-5': true, '5,-5': true,
                '6,6': true, '-6,6': true, '-6,-6': true, '6,-6': true,
                '7,7': true, '-7,7': true, '-7,-7': true, '7,-7': true,
                '8,8': true, '-8,8': true, '-8,-8': true, '8,-8': true,
                '9,9': true, '-9,9': true, '-9,-9': true, '9,-9': true,
                '10,10': true, '-10,10': true, '-10,-10': true, '10,-10': true,
                '11,11': true, '-11,11': true, '-11,-11': true, '11,-11': true,
                '12,12': true, '-12,12': true, '-12,-12': true, '12,-12': true,
                // Other specific intersections
                '-11,5': true, '-9,8': true, '-8,9': true, '-5,11': true, '5,11': true,
                '8,9': true, '9,8': true, '11,5': true, '11,-5': true, '9,-8': true,
                '8,-9': true, '5,-11': true, '-5,-11': true, '-8,-9': true, '-9,-8': true,
                '-11,-5': true,
                '6,0': true, '-6,0': true, '-8,3': true, '-8,-3': true, '8,3': true,
                '8,-3': true
            };
            
            /**
             * The goldenLinesDict defines the connections for the special golden lines.
             * Portal pieces can move along these lines in addition to their regular adjacent moves.
             */
            const goldenLinesDict = {
                "-12,0": [{x: -11, y: 5}, {x: -11, y: -5}, {x: -8, y: 3}, {x: -8, y: -3}],
                "-11,5": [{x: -12, y: 0}, {x: -9, y: 8}],
                "-9,8": [{x: -11, y: 5}, {x: -8, y: 3}, {x: -6, y: 6}, {x: -8, y: 9}],
                "-8,9": [{x: -9, y: 8}, {x: -5, y: 11}, {x: -6, y: 6}],
                "-5,11": [{x: -8, y: 9}, {x: 0, y: 12}],
                "0,12": [{x: -5, y: 11}, {x: 5, y: 11}],
                "5,11": [{x: 0, y: 12}, {x: 8, y: 9}],
                "8,9": [{x: 5, y: 11}, {x: 9, y: 8}, {x: 6, y: 6}],
                "9,8": [{x: 11, y: 5}, {x: 8, y: 3}, {x: 6, y: 6}, {x: 8, y: 9}],
                "11,5": [{x: 12, y: 0}, {x: 9, y: 8}],
                "12,0": [{x: 11, y: 5}, {x: 11, y: -5}, {x: 8, y: 3}, {x: 8, y: -3}],
                "11,-5": [{x: 12, y: 0}, {x: 9, y: -8}],
                "9,-8": [{x: 11, y: -5}, {x: 8, y: -3}, {x: 6, y: -6}, {x: 8, y: -9}],
                "8,-9": [{x: 9, y: -8}, {x: 5, y: -11}, {x: 6, y: -6}],
                "5,-11": [{x: 8, y: -9}, {x: 0, y: -12}],
                "0,-12": [{x: 5, y: -11}, {x: -5, y: -11}],
                "-5,-11": [{x: 0, y: -12}, {x: -8, y: -9}],
                "-8,-9": [{x: -5, y: -11}, {x: -9, y: -8}, {x: -6, y: -6}],
                "-9,-8": [{x: -11, y: -5}, {x: -8, y: -3}, {x: -6, y: -6}, {x: -8, y: -9}],
                "-11,-5": [{x: -12, y: 0}, {x: -9, y: -8}],
                // Square Corners
                "6,6": [{x: 8, y: 9}, {x: 9, y: 8}, {x: -6, y: 6}],
                "6,-6": [{x: 8, y: -9}, {x: 9, y: -8}, {x: -6, y: -6}],
                "-6,-6": [{x: -8, y: -9}, {x: -9, y: -8}, {x: 6, y: -6}],
                "-6,6": [{x: -8, y: 9}, {x: -9, y: 8}, {x: 6, y: 6}],
                // Square Center Edge
                "6,0": [{x: 8, y: 3}, {x: 8, y: -3}],
                "-6,0": [{x: -8, y: 3}, {x: -8, y: -3}],
                // Outer Diamonds
                "-8,3": [{x: -6, y: 0}, {x: -12, y: 0}, {x: -9, y: 8}],
                "-8,-3": [{x: -6, y: 0}, {x: -12, y: 0}, {x: -9, y: -8}],
                "8,3": [{x: 6, y: 0}, {x: 12, y: 0}, {x: 9, y: 8}],
                "8,-3": [{x: 6, y: 0}, {x: 12, y: 0}, {x: 9, y: -8}],
            };

            /**
             * Draws the entire game board, including lines, intersections, and pieces.
             * This function is called whenever a change needs to be visually updated.
             */
            function drawBoard() {
                // Clear the canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                boardSize = Math.min(canvas.width, canvas.height);
                originX = boardSize / 2;
                originY = boardSize / 2;

                // Draw the golden lines first
                ctx.strokeStyle = 'gold';
                ctx.lineWidth = 2;
                for (const startCoordStr in goldenLinesDict) {
                    const connections = goldenLinesDict[startCoordStr];
                    const [startX, startY] = startCoordStr.split(',').map(Number);
                    for (const endCoord of connections) {
                        ctx.beginPath();
                        ctx.moveTo(originX + startX * gridSize, originY - startY * gridSize);
                        ctx.lineTo(originX + endCoord.x * gridSize, originY - endCoord.y * gridSize);
                        ctx.stroke();
                    }
                }

                // Draw the board lines
                ctx.strokeStyle = '#a0aec0'; // Light gray lines
                ctx.lineWidth = 1;
                for (const coordStr in boardDict) {
                    const [x, y] = coordStr.split(',').map(Number);

                    // Check for adjacent intersections to draw connections
                    const adjacentOffsets = [
                        { dx: 1, dy: 0 }, { dx: -1, dy: 0 }, { dx: 0, dy: 1 }, { dx: 0, dy: -1 },
                        { dx: 1, dy: 1 }, { dx: -1, dy: -1 }, { dx: 1, dy: -1 }, { dx: -1, dy: 1 }
                    ];

                    for (const offset of adjacentOffsets) {
                        const nextX = x + offset.dx;
                        const nextY = y + offset.dy;
                        const nextCoordStr = `${nextX},${nextY}`;
                        if (boardDict[nextCoordStr]) {
                            ctx.beginPath();
                            ctx.moveTo(originX + x * gridSize, originY - y * gridSize);
                            ctx.lineTo(originX + nextX * gridSize, originY - nextY * gridSize);
                            ctx.stroke();
                        }
                    }
                }

                // Draw all intersections as points
                ctx.fillStyle = '#f7fafc'; // White dots
                for (const coordStr in boardDict) {
                    const [x, y] = coordStr.split(',').map(Number);
                    ctx.beginPath();
                    ctx.arc(originX + x * gridSize, originY - y * gridSize, 3, 0, 2 * Math.PI);
                    ctx.fill();
                }

                // Draw pieces
                for (const coordStr in pieces) {
                    const piece = pieces[coordStr];
                    const [x, y] = coordStr.split(',').map(Number);

                    const drawX = originX + x * gridSize;
                    const drawY = originY - y * gridSize;

                    ctx.save();
                    ctx.translate(drawX, drawY);

                   
