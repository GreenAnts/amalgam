<!DOCTYPE html>
<html>
<head>
    <title>Portal Indicator Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .nav-header {
            background: #2c3e50;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .nav-btn {
            display: inline-block;
            padding: 8px 16px;
            margin-right: 10px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .nav-btn:hover {
            background: #2980b9;
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-item {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #fafafa;
        }
        .test-item h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .test-canvas {
            border: 2px solid #333;
            margin: 10px 0;
            background: white;
        }
        .test-controls {
            margin: 15px 0;
        }
        .test-btn {
            padding: 8px 16px;
            margin: 5px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .test-btn:hover {
            background: #229954;
        }
        .test-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .result.pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .result.fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Header -->
        <div class="nav-header">
            <a href="../../tests.html" class="nav-btn">üè† Testing Hub</a>
            <a href="../comprehensive-game-mechanics-test.html" class="nav-btn">üìä Full Suite</a>
        </div>
        
        <div class="test-header">
            <h1>üîÑ Portal Indicator Tests</h1>
            <p>Testing portal swap indicator styling and functionality</p>
        </div>
        
        <div class="test-grid">
            <div class="test-item">
                <h3>Test 1: Standard Move Indicators</h3>
                <canvas id="test1Canvas" class="test-canvas" width="600" height="600"></canvas>
                <div class="test-controls">
                    <button class="test-btn" onclick="testStandardIndicators()">Test Standard Indicators</button>
                </div>
                <div id="test1Result"></div>
            </div>
            
            <div class="test-item">
                <h3>Test 2: Portal Swap Indicators</h3>
                <canvas id="test2Canvas" class="test-canvas" width="600" height="600"></canvas>
                <div class="test-controls">
                    <button class="test-btn" onclick="testPortalSwapIndicators()">Test Portal Swap Indicators</button>
                </div>
                <div id="test2Result"></div>
            </div>
            
            <div class="test-item">
                <h3>Test 3: Mixed Indicators</h3>
                <canvas id="test3Canvas" class="test-canvas" width="600" height="600"></canvas>
                <div class="test-controls">
                    <button class="test-btn" onclick="testMixedIndicators()">Test Mixed Indicators</button>
                    <button class="test-btn" onclick="startAnimatedDemo()">Start Animated Demo</button>
                </div>
                <div id="test3Result"></div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { renderValidMoveIndicators, renderSelectionHighlight } from '../../ui/graphics.js';
        
        // Test state with pieces
        const testState = {
            pieces: {
                'portal1': {
                    id: 'portal1',
                    type: 'Portal',
                    coords: [2, 2],
                    player: 'circles'
                },
                'portal2': {
                    id: 'portal2',
                    type: 'Portal',
                    coords: [-2, -2],
                    player: 'squares'
                },
                'piece1': {
                    id: 'piece1',
                    type: 'Ruby',
                    coords: [1, 1],
                    player: 'circles'
                }
            }
        };
        
        // Create render context
        function createRenderContext(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            return {
                ctx: ctx,
                originX: 200,
                originY: 200,
                gridSize: 45
            };
        }
        
        // Draw board background
        function drawBoardBackground(ctx) {
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, 400, 400);
            
            // Draw grid lines
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 400; i += 45) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, 400);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(400, i);
                ctx.stroke();
            }
        }
        
        // Draw pieces
        function drawPieces(ctx, pieces) {
            Object.values(pieces).forEach(piece => {
                const [x, y] = piece.coords;
                const centerX = 200 + x * 45;
                const centerY = 200 - y * 45;
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, 15, 0, 2 * Math.PI);
                
                if (piece.type === 'Portal') {
                    ctx.fillStyle = '#87CEEB';
                    ctx.strokeStyle = '#4682B4';
                } else {
                    ctx.fillStyle = '#E63960';
                    ctx.strokeStyle = '#B22222';
                }
                
                ctx.fill();
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Draw piece label
                ctx.fillStyle = '#000';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(piece.type, centerX, centerY + 4);
            });
        }
        
        // Test functions
        window.testStandardIndicators = function() {
            const renderContext = createRenderContext('test1Canvas');
            const { ctx } = renderContext;
            
            // Clear and draw background
            drawBoardBackground(ctx);
            
            // Draw pieces
            drawPieces(ctx, testState.pieces);
            
            // Test standard move indicators (no portals)
            const standardMoves = [[0, 0], [3, 3], [-1, -1]];
            renderValidMoveIndicators(renderContext, standardMoves, testState);
            
            // Add result
            const resultDiv = document.getElementById('test1Result');
            resultDiv.innerHTML = '<div class="result pass">‚úÖ Standard indicators rendered (green circles)</div>';
        };
        
        window.testPortalSwapIndicators = function() {
            const renderContext = createRenderContext('test2Canvas');
            const { ctx } = renderContext;
            
            // Clear and draw background
            drawBoardBackground(ctx);
            
            // Draw pieces
            drawPieces(ctx, testState.pieces);
            
            // Test portal swap indicators (targeting portal locations)
            const portalSwapMoves = [[2, 2], [-2, -2]]; // These are portal locations
            renderValidMoveIndicators(renderContext, portalSwapMoves, testState);
            
            // Add result
            const resultDiv = document.getElementById('test2Result');
            resultDiv.innerHTML = '<div class="result pass">‚úÖ Modern portal swap indicators rendered (purple pulsing rings with glow)</div>';
        };
        
        window.testMixedIndicators = function() {
            const renderContext = createRenderContext('test3Canvas');
            const { ctx } = renderContext;
            
            // Clear and draw background
            drawBoardBackground(ctx);
            
            // Draw pieces
            drawPieces(ctx, testState.pieces);
            
            // Test mixed indicators (some portal, some standard)
            const mixedMoves = [[2, 2], [0, 0], [-2, -2], [3, 3]]; // Mix of portal and standard locations
            renderValidMoveIndicators(renderContext, mixedMoves, testState);
            
            // Add result
            const resultDiv = document.getElementById('test3Result');
            resultDiv.innerHTML = '<div class="result pass">‚úÖ Mixed indicators rendered (purple pulsing rings with glow for portals, green rings for standard)</div>';
        };

        // Add animated demo function
        window.startAnimatedDemo = function() {
            const renderContext = createRenderContext('test3Canvas');
            const { ctx } = renderContext;
            
            function animate() {
                // Clear and draw background
                drawBoardBackground(ctx);
                
                // Draw pieces
                drawPieces(ctx, testState.pieces);
                
                // Test mixed indicators with animation
                const mixedMoves = [[2, 2], [0, 0], [-2, -2], [3, 3]];
                renderValidMoveIndicators(renderContext, mixedMoves, testState);
                
                // Continue animation
                requestAnimationFrame(animate);
            }
            
            animate();
            
            // Update result
            const resultDiv = document.getElementById('test3Result');
            resultDiv.innerHTML = '<div class="result info">üîÑ Animated demo running - watch the modern pulsing rings!</div>';
        };
        
        // Initialize tests
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîÑ Portal Indicator Tests loaded');
        });
    </script>
</body>
</html>
