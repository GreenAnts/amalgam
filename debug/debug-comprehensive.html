<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
    </style>
</head>
<body>
    <h1>Comprehensive Debug Test</h1>
    <div id="results"></div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function addResult(test, status, message, data = null) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <strong>${test}:</strong> ${status.toUpperCase()} - ${message}
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        async function runTest(name, testFn) {
            try {
                const result = await testFn();
                addResult(name, 'success', result.message || 'OK', result.data);
                return result;
            } catch (error) {
                addResult(name, 'error', error.message);
                throw error;
            }
        }
        
        async function runAllTests() {
            try {
                // Test 1: Logger
                await runTest('Logger Module', async () => {
                    const { logger } = await import('./utils/logger.js');
                    return { message: 'Logger imported successfully' };
                });
                
                // Test 2: Helpers
                await runTest('Helpers Module', async () => {
                    const { deepCopy, clamp } = await import('./utils/helpers.js');
                    return { message: 'Helpers imported successfully' };
                });
                
                // Test 3: Types
                await runTest('Types Module', async () => {
                    const typesModule = await import('./core/types.js');
                    return { message: 'Types imported successfully' };
                });
                
                // Test 4: Board
                await runTest('Board Module', async () => {
                    const { createBoard, createInitialState } = await import('./core/board.js');
                    return { message: 'Board module imported successfully' };
                });
                
                // Test 5: Rules
                await runTest('Rules Module', async () => {
                    const { isValidMove, applyMove } = await import('./core/rules.js');
                    return { message: 'Rules module imported successfully' };
                });
                
                // Test 6: Graphics
                await runTest('Graphics Module', async () => {
                    const { createGameCanvas } = await import('./ui/graphics.js');
                    return { message: 'Graphics module imported successfully' };
                });
                
                // Test 7: Interactions
                await runTest('Interactions Module', async () => {
                    const { InteractionManager } = await import('./ui/interactions.js');
                    return { message: 'Interactions module imported successfully' };
                });
                
                // Test 8: Player
                await runTest('Player Module', async () => {
                    const { createPlayer } = await import('./game/player.js');
                    return { message: 'Player module imported successfully' };
                });
                
                // Test 9: GameManager
                await runTest('GameManager Module', async () => {
                    const { GameManager } = await import('./game/gameManager.js');
                    return { message: 'GameManager module imported successfully' };
                });
                
                // Test 10: Data Loading
                await runTest('Board Data Loading', async () => {
                    const response = await fetch('./data/board-data.json');
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    return { 
                        message: 'Board data loaded successfully', 
                        data: { 
                            schema: data.schema, 
                            intersections: data.total_intersections,
                            golden: data.golden_coordinates?.length,
                            standard: data.standard_coordinates?.length
                        } 
                    };
                });
                
                // Test 11: Piece Definitions Loading
                await runTest('Piece Definitions Loading', async () => {
                    const response = await fetch('./data/piece-definitions.json');
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    return { 
                        message: 'Piece definitions loaded successfully',
                        data: {
                            circles: Object.keys(data.piece_definitions.circles_pieces).length,
                            squares: Object.keys(data.piece_definitions.squares_pieces).length
                        }
                    };
                });
                
                // Test 12: Board Generation
                await runTest('Board Generation', async () => {
                    const { createBoard } = await import('./core/board.js');
                    const response = await fetch('./data/board-data.json');
                    const boardData = await response.json();
                    const board = createBoard(boardData);
                    
                    if (!board.goldenLineConnections || board.goldenLineConnections.length === 0) {
                        throw new Error('Board missing goldenLineConnections array');
                    }
                    
                    return {
                        message: 'Board generated successfully',
                        data: {
                            intersections: board.intersections.length,
                            goldenConnections: board.goldenLineConnections.length,
                            goldenIntersections: board.goldenLineIntersections.length
                        }
                    };
                });
                
                // Test 13: Canvas Creation
                await runTest('Canvas Creation', async () => {
                    const { createGameCanvas } = await import('./ui/graphics.js');
                    const response = await fetch('./data/board-data.json');
                    const boardData = await response.json();
                    
                    const container = document.createElement('div');
                    container.style.width = '400px';
                    container.style.height = '400px';
                    document.body.appendChild(container);
                    
                    const gameCanvas = createGameCanvas(container, boardData);
                    
                    return {
                        message: 'Canvas created successfully',
                        data: {
                            width: gameCanvas.canvas.width,
                            height: gameCanvas.canvas.height,
                            boardDictSize: Object.keys(gameCanvas.boardDict).length
                        }
                    };
                });
                
                // Test 14: Main Module
                await runTest('Main Module', async () => {
                    const mainModule = await import('./main.js');
                    return { message: 'Main module imported successfully' };
                });
                
                addResult('All Tests', 'success', 'All tests completed successfully!');
                
            } catch (error) {
                addResult('Test Suite', 'error', `Test suite failed: ${error.message}`);
                console.error('Comprehensive test error:', error);
            }
        }
        
        runAllTests();
    </script>
</body>
</html>

